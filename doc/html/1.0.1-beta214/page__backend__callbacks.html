<head>
 <link href="pantheios.css" rel="stylesheet" type="text/css">
<!--
 <title>Pantheios - The C++ Diagnostic Logging Sweetspot</title>
-->
</head>

<table width = "100%">
 <tr>
  <td align = "left" valign = "middle">
   <a href = "http://www.synesis.com.au/"><img src = "syn_head.jpg" border = "0" width = "343" height = "50" alt = "Synesis Software" /></a>
  </td>
  <td align = "right" valign = "middle">
   <a href = "http://stlsoft.org"><img src = "stlsoft200x100.jpg" border = "0" width = "100" height = "50" alt = "STLSoft - ... Robust, Lightweight, Cross-platform, Template Software ..." /></a>
  </td>
 </tr>
 <tr>
  <td width = "100%" colspan = "2">
   <hr width = "100%">
  </td>
 </tr>
</table>
<!-- Generated by Doxygen 1.5.4 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
  </ul>
</div>
<h1><a class="anchor" name="page__backend__callbacks">Back-end Callbacks </a></h1>The Pantheios stock back-ends are intentionally simple, and their incorporation into a process/dynamic-library is resolved at link-time.<p>
Consequently, the modification of back-end characteristics at runtime is not directly supported, and it is the intention that use of sophisticated back-ends whose behaviour is runtime modifiable is left to back-end extensions. The stock back-ends provide simple transports only.<p>
Notwithstanding, certain stock back-ends have a potential spectrum of behaviour that means some limited runtime decision-making would be of use in a significant number of scenarios. It has proven possible to facilitate this without breaking the fundamental architecture of Pantheios, whose significant benefits (in particular the one-time, main-thread initialisation of front and back-ends), it would be unwise to disturb. Hence, these stock back-ends provide "callback" functionality.<p>
This is probably best-explained by considering one of the cases in detail. We'll look at the <a class="el" href="group__group____backend____stock__backends____WindowsConsole.html">Windows Console</a> back-end. We can identify three distinct use modes:<p>
<ul>
<li><a class="el" href="page__backend__callbacks.html#section__backend__callbacks__implicit_without_callback">Implicit, Without Callback</a></li><li><a class="el" href="page__backend__callbacks.html#section__backend__callbacks__implicit_with_callback">Implicit, With Callback</a></li><li><a class="el" href="page__backend__callbacks.html#section__backend__callbacks__explicit">Explicit</a></li></ul>
<h2><a class="anchor" name="section__backend__callbacks__implicit_without_callback">
Implicit, Without Callback</a></h2>
This is the case when the version of the library built without callback support is used within Pantheios. This can be achieved by explicitly linking to it, e.g.<p>
 
<pre>
  g++ -o ..\..\bin\pantheios.1.ex.cpp.1.gcc34.debug.exe \
    .\example_cpp_1.debug.obj\
    ..\..\lib\pantheios.1.core.gcc34.debug.lib\
    ..\..\lib\pantheios.1.fe.simple.gcc34.debug.lib\
    ..\..\lib\<b>pantheios.1.be.WindowsConsole.gcc34.debug.lib</b>\
    ..\..\lib\<b>pantheios.1.bec.WindowsConsole.gcc34.debug.lib</b>\
    -lkernel32 -luser32 -ladvapi32 -luuid -lwininet -lole32 -loleaut32</code>
</pre>
<p>
or by implicitly linking to it, by <code>#include</code>-ing the requisite implicit link header file, e.g.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &lt;<a class="code" href="be_8WindowsConsole_8h.html" title="[C, C++] Implicitly links in the Pantheios Windows Console Back-End Library as the...">pantheios/implicit_link/be.WindowsConsole.h</a>&gt;</span>
</pre></div><p>
In this mode, the "default" combination of characteristics of the back-end is the only choice. In the case of <a class="el" href="group__group____backend____stock__backends____WindowsConsole.html">Windows Console</a> each log-statement bears a prefix containing the <b>process identity</b>, the <b>local time</b>, and the log statement <b>severity level</b>, and that the statement output is coloured according to the severity level, as shown in the following screenshot of the output of one of the Pantheios example programs:<p>
 
<pre>
<table width="100%">
 <tr><td align = "center">
   <img src = "w32cons_example_1.png" />
 </td></tr>
</table>
</pre>
<h2><a class="anchor" name="section__backend__callbacks__implicit_with_callback">
Implicit, With Callback</a></h2>
This is the case when the version of the library built <b>with</b> callback support is used within Pantheios. This can be achieved by explicitly linking to it, e.g.<p>
 
<pre>
  g++ -o ..\..\bin\pantheios.1.ex.cpp.1.gcc34.debug.exe \
    .\example_cpp_1.debug.obj\
    ..\..\lib\pantheios.1.core.gcc34.debug.lib\
    ..\..\lib\pantheios.1.fe.simple.gcc34.debug.lib\
    ..\..\lib\<b>pantheios.1.be.WindowsConsole.WithCallback.gcc34.debug.lib</b>\
    ..\..\lib\<b>pantheios.1.bec.WindowsConsole.WithCallback.gcc34.debug.lib</b>\
    -lkernel32 -luser32 -ladvapi32 -luuid -lwininet -lole32 -loleaut32</code>
</pre>
<p>
or by implicitly linking to it, by <code>#include</code>-ing the requisite implicit link header file, e.g.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &lt;<a class="code" href="be_8WindowsConsole_8WithCallback_8h.html" title="[C, C++] Implicitly links in the callback version of the Pantheios Windows Console...">pantheios/implicit_link/be.WindowsConsole.WithCallback.h</a>&gt;</span>
</pre></div><p>
In this mode, the user must define the callback function <a class="el" href="group__group____backend____stock__backends____WindowsConsole.html#g727db5dc92faa53109ab1891ec11f22e" title="Callback function defined by the application, invoked when the API is initialised...">pantheios_be_WindowsConsole_getAppInit()</a>, which will be invoked by the back-end library during its initialisation. The function parameters specify a back-end identifier and a pointer to an instance of <a class="el" href="structpan__be__WindowsConsole__init__t.html" title="Structure used for specifying initialisation information to the be.WindowsConsole...">pan_be_WindowsConsole_init_t</a>.<p>
<div class="fragment"><pre class="fragment">  <a class="code" href="group__group____utility.html#g3c5b9595ee24af8637349cb81a80e9f1" title="Used to declare and define Pantheios API functions.">PANTHEIOS_CALL</a>(<span class="keywordtype">void</span>) <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g727db5dc92faa53109ab1891ec11f22e" title="Callback function defined by the application, invoked when the API is initialised...">pantheios_be_WindowsConsole_getAppInit</a>(<span class="keywordtype">int</span> backEndId, <a class="code" href="structpan__be__WindowsConsole__init__t.html" title="Structure used for specifying initialisation information to the be.WindowsConsole...">pan_be_WindowsConsole_init_t</a> *<a class="code" href="group__group____core__library.html#gced91d3c14209ed4e49a3329f689fabf" title="Equivalent to pantheios_init().">init</a>) <span class="comment">/* throw() */</span>;
</pre></div><p>
<code><b>backEndId</b></code> is the value specified to <a class="el" href="group__group____backend____stock__backends____WindowsConsole.html#gcc00c5b548d1ae07c8c7aacb290ceff1" title="Implements the functionality for pantheios_be_init() over the Windows Console API...">pantheios_be_WindowsConsole_init()</a> by the Pantheios core or, if local/remote splitting is being used, by the <a class="el" href="group__group____backend____stock__backends____lrsplit.html">be.lrsplit</a> back-end.<p>
<code><b>init</b></code> points to an instance of <a class="el" href="structpan__be__WindowsConsole__init__t.html" title="Structure used for specifying initialisation information to the be.WindowsConsole...">pan_be_WindowsConsole_init_t</a> that has already been initialised (by <a class="el" href="group__group____backend____stock__backends____WindowsConsole.html#g0086751f92eaca9fbecc544cf5e85f61" title="Fills out a copy of the initialisation structure with default values (representative...">pantheios_be_WindowsConsole_getDefaultAppInit()</a>) according to the default characteristics for the back-end. Thus, the implementation need only make changes to the desired characteristics.<p>
The following example suppresses the display of the time, and modifies the colours used to display the pantheios::notice and pantheios::debug severities.<p>
<div class="fragment"><pre class="fragment">  <a class="code" href="group__group____utility.html#g3c5b9595ee24af8637349cb81a80e9f1" title="Used to declare and define Pantheios API functions.">PANTHEIOS_CALL</a>(<span class="keywordtype">void</span>) <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g727db5dc92faa53109ab1891ec11f22e" title="Callback function defined by the application, invoked when the API is initialised...">pantheios_be_WindowsConsole_getAppInit</a>(<span class="keywordtype">int</span> <span class="comment">/* backEndId */</span>, <a class="code" href="structpan__be__WindowsConsole__init__t.html" title="Structure used for specifying initialisation information to the be.WindowsConsole...">pan_be_WindowsConsole_init_t</a> *init) <span class="comment">/* throw() */</span>
  {
    init-&gt;flags |= PANTHEIOS_BE_WINDOWSCONSOLE_F_NO_TIME; <span class="comment">/* Suppress the display of time */</span>

    init-&gt;colours[pantheios::debug]   = FOREGROUND_BLUE | FOREGROUND_INTENSITY; <span class="comment">/* Lose the white background */</span>
    init-&gt;colours[pantheios::notice]  = FOREGROUND_BLUE | FOREGROUND_GREEN | FOREGROUND_RED; <span class="comment">/* Lose the foreground intensity */</span>
  }
</pre></div><p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>If implementing in C++, this must be defined in the global namespace.</dd></dl>
<h2><a class="anchor" name="section__backend__callbacks__explicit">
Explicit</a></h2>
Explicit use of a back-end may be made independent of Pantheios. For example, <b>pantheios.COM</b>, the adjunct library of Pantheios for COM components, uses several Pantheios back-end libraries in support of its Logger object model: the current version includes <b>ConsoleLogger</b>, <b>DebugLogger</b>, <b>ErrorObjectLogger</b>, <b>EventLogLogger</b>, and <b>SysLogLogger</b>. The back-end library (un)initialisation calls are made directly, and the back-end library context (returned by the requisite <code>_init()</code> function, e.g. <a class="el" href="group__group____backend____stock__backends____WindowsConsole.html#gcc00c5b548d1ae07c8c7aacb290ceff1" title="Implements the functionality for pantheios_be_init() over the Windows Console API...">pantheios_be_WindowsConsole_init()</a>) maintained by the calling application.<p>
When making explicit use of a back-end library, the caller can pass in a non-<b>NULL</b> pointer to an initialisation structure, something that <a class="el" href="group__group____core__library.html">Pantheios</a> itself is not able to do. The following code shows an example of explicit use of the <a class="el" href="group__group____backend____stock__backends____WindowsConsole.html">Windows Console</a> back-end, wherein the display of time is suppressed:<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="backend_8h.html" title="[C, C++] Definition of the Pantheios Back-end API.">pantheios/backend.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="backends_2bec_8WindowsConsole_8h.html" title="[C, C++] Pantheios Windows Console Back-end Common API">pantheios/backends/bec.WindowsConsole.h</a>&gt;</span>

<span class="keywordtype">int</span> main()
{
  <a class="code" href="structpan__be__WindowsConsole__init__t.html" title="Structure used for specifying initialisation information to the be.WindowsConsole...">pan_be_WindowsConsole_init_t</a>  init;
  <span class="keywordtype">void</span>*                         token;

  <span class="comment">// Initialise the structure to the default characteristics</span>
  <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g0086751f92eaca9fbecc544cf5e85f61" title="Fills out a copy of the initialisation structure with default values (representative...">pantheios_be_WindowsConsole_getDefaultAppInit</a>(&amp;init);

  <span class="comment">// Suppress the display of time</span>
  init.<a class="code" href="structpan__be__WindowsConsole__init__t.html#871c6b09b873d8aa428e6d514271b2e1">flags</a> |= PANTHEIOS_BE_WINDOWSCONSOLE_F_NO_TIME;

  <span class="comment">// Explicitly initialise the back-end library</span>
  <span class="keywordflow">if</span>(0 &lt;= <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#gcc00c5b548d1ae07c8c7aacb290ceff1" title="Implements the functionality for pantheios_be_init() over the Windows Console API...">pantheios_be_WindowsConsole_init</a>( <span class="stringliteral">"bec.WindowsConsole test"</span>
                                          , <a class="code" href="group__group____backend____stock__ids.html#g20b68bb433dbf0b800d60ebbd8a94e27" title="Identifies the local (or only) back-end in a link-unit.">PANTHEIOS_BEID_LOCAL</a>
                                          , &amp;init
                                          , NULL
                                          , &amp;token))
  {
    <span class="comment">// Use the library to emit some statements</span>

    <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g8e81722ff1cd608eff18857329144339" title="Implements the functionality for pantheios_be_logEntry() over the Windows Console...">pantheios_be_WindowsConsole_logEntry</a>(NULL, token, 0, <span class="stringliteral">"abc"</span>, 3);
    <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g8e81722ff1cd608eff18857329144339" title="Implements the functionality for pantheios_be_logEntry() over the Windows Console...">pantheios_be_WindowsConsole_logEntry</a>(NULL, token, 1, <span class="stringliteral">"abc"</span>, 3);
    <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g8e81722ff1cd608eff18857329144339" title="Implements the functionality for pantheios_be_logEntry() over the Windows Console...">pantheios_be_WindowsConsole_logEntry</a>(NULL, token, 2, <span class="stringliteral">"abc"</span>, 3);
    <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g8e81722ff1cd608eff18857329144339" title="Implements the functionality for pantheios_be_logEntry() over the Windows Console...">pantheios_be_WindowsConsole_logEntry</a>(NULL, token, 3, <span class="stringliteral">"abc"</span>, 3);
    <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g8e81722ff1cd608eff18857329144339" title="Implements the functionality for pantheios_be_logEntry() over the Windows Console...">pantheios_be_WindowsConsole_logEntry</a>(NULL, token, 4, <span class="stringliteral">"abc"</span>, 3);
    <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g8e81722ff1cd608eff18857329144339" title="Implements the functionality for pantheios_be_logEntry() over the Windows Console...">pantheios_be_WindowsConsole_logEntry</a>(NULL, token, 5, <span class="stringliteral">"abc"</span>, 3);
    <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g8e81722ff1cd608eff18857329144339" title="Implements the functionality for pantheios_be_logEntry() over the Windows Console...">pantheios_be_WindowsConsole_logEntry</a>(NULL, token, 6, <span class="stringliteral">"abc"</span>, 3);
    <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g8e81722ff1cd608eff18857329144339" title="Implements the functionality for pantheios_be_logEntry() over the Windows Console...">pantheios_be_WindowsConsole_logEntry</a>(NULL, token, 7, <span class="stringliteral">"abc"</span>, 3);

    <span class="comment">// Uninitialise the library</span>
    <a class="code" href="group__group____backend____stock__backends____WindowsConsole.html#g884c686c5c4ff5ed05a8c890bdf84d8f" title="Implements the functionality for pantheios_be_uninit() over the Windows Console API...">pantheios_be_WindowsConsole_uninit</a>(token);
  }

  <span class="keywordflow">return</span> EXIT_SUCCESS;
}
</pre></div><p>
The output from this program is shown in the following screenshot:  
<pre>
<table width="100%">
 <tr><td align = "center">
   <img src = "w32cons_example_3.png" />
 </td></tr>
</table>
</pre>
<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>When linking to a back-end that is being used explicitly, there is little or no point in linking to the version that is built for <a class="el" href="page__backend__callbacks.html">callback</a>, since the explicit initialisation provides equivalent, and direct, control of the back-end library characteristics. Indeed, you'd only receive a <a class="el" href="page__backend__callbacks.html">callback</a>, of the exact characteristics you'd specified a few instructions earlier.</dd></dl>
As the public distribution of the Pantheios libraries matures, it's likely that wrappers for those back-ends that are regularly used in explicit mode will be written and made available. If you want to contribute, you'll be very welcome. <table width = "100%">
 <tr>
  <td width = "100%" colspan = "2">
   <hr width = "100%">
  </td>
 </tr>
 <tr>
  <td align = "center" valign = "middle">
   <font size = "-1">
    <a href = "http://pantheios.org/"><b>pantheios</b></a>
    Library documentation 
    © Matthew Wilson &amp;
    <a href="http://www.synesis.com.au">Synesis Software</a>,
    2006-2011
   </font>
  </td>
  <td align = "center" valign = "middle">
   <a href="http://sourceforge.net">
    <img src="http://sourceforge.net/sflogo.php?group_id=141831&amp;type=2" width="125" height="37" border="0" alt="SourceForge.net Logo" />
   </a>
  </td>
 </tr>
</table>
